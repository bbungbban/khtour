<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart42.khtour.mapper.CommunityMapper">

	<resultMap type="Community" id="communityResultMap">
		<id column="comm_name" property="commName"/>
		<result column="member_id" property="memberId"/>
		<result column="reg_date" property="regDate"/>
		<result column="category" property="category"/>
		<result column="banner" property="banner"/>
		<result column="avatar" property="avatar"/>
		<result column="member_cnt" property="memberCnt"/>
		<result column="online_member_cnt" property="onlineMemberCnt"/>
		<result column="comm_desc" property="commDesc"/>
	</resultMap> 
	<resultMap type="Rule" id="ruleResultMap">
		<id column="rule_code" property="ruleCode"/>
		<result column="comm_name" property="commName"/>
		<result column="title" property="title"/>
		<result column="detail" property="detail"/>
		<result column="reg_time" property="reg_time"/>
	</resultMap>

	<!-- <select id="getCommunityList" resultMap="communityResultMap"> -->
	<select id="getCommunityList"  resultMap="communityResultMap">
			SELECT
				c.comm_name
				,c.member_id		 
				,c.reg_date
				,c.category
				,c.banner	 
				,c.avatar    
				,c.member_cnt
				,c.online_member_cnt
				,c.comm_desc
			FROM
				tb_community AS c
			Order BY 
				c.member_cnt DESC;	
	</select>
	<select id="getCommunityByName"  resultMap="communityResultMap">
			SELECT
				c.comm_name
				,c.member_id		 
				,c.reg_date
				,c.category
				,c.banner	 
				,c.avatar    
				,c.member_cnt
				,c.online_member_cnt
				,c.comm_desc
			FROM
				tb_community AS c
			Where
				c.comm_name = #{commName};	
	</select>
	<select id="getRuleListByCommName"  resultMap="ruleResultMap">
			SELECT
				r.rule_code
				,r.comm_name
				,r.title
				,r.detail
				,r.reg_time
			FROM
			 tb_comm_rules AS r
			INNER JOIN
			 tb_community AS c
			ON
				r.comm_name = c.comm_name
			WHERE 
				c.comm_name = #{commName};
	</select>
	
	<insert id="addCommunity" parameterType="Community">
		/*회원가입*/
		INSERT INTO tb_community
			(	 comm_code
				,member_id		 
				,reg_date
				,comm_name
				,category
				,banner	 
				,avatar    
				,member_cnt
				,online_member_cnt
				,comm_desc
		)VALUES (
			#{commCode}
			, #{memberId}
			, CURDATE()
			, #{commName}
			, #{category}
			, #{banner}
			, #{avatar}
			, #{memberCnt}
			, #{onlineMemberCnt}
			, #{commDesc}
		);
	</insert>
	
	<select id="isNameCheck" parameterType="String" resultType="boolean">
		SELECT
			if(Count(1) = 1,0,1)
		FROM
			tb_community AS c
		where
			c.comm_name = #{commName};	
	</select>



	
</mapper>