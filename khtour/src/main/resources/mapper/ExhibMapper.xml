<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart42.khtour.mapper.ExhibMapper">
	<resultMap type="Exhib" 				id="exhibResultMap">
		<id column="exhib_code" 			property="exhibCode" />			<!-- 전시회 코드 -->
		<result column="mus_code" 			property="musCode" />			<!-- 문화재 및 박물관 코드 -->
		<result column="exhib_cate" 		property="exhibCate" />			<!-- 전시회카테고리코드 -->
		<result column="exhib_cate_name" 	property="exhibCateName" />		<!-- 전시회카테고리 -->
		<result column="exhib_name" 		property="exhibName" />			<!-- 전시회이름 -->
		<result column="exhib_start" 		property="exhibStart" />		<!-- 전시회시작일 -->
		<result column="exhib_end"	 		property="exhibEnd" />			<!-- 전시회종료일 -->
		<result column="exhib_con"			property="exhibCon" />			<!-- 전시회내용 -->
		<result column="exhib_current" 		property="exhibCurrent" />		<!-- 전시회현황 -->
		<result column="exhib_img" 			property="exhibImg" />			<!-- 포스터이미지-->
		<result column="exhib_page" 		property="exhibPage" />			<!-- 전시회홈페이지-->
	</resultMap>

	<!-- 전시회 등록 SQL -->
	<insert id="addExhib" parameterType="Exhib">
		INSERT INTO
		tb_exhib
		( exhib_code
		,mus_code
		,exhib_cate
		,exhib_cate_name
		,exhib_name
		,exhib_start
		,exhib_end
		,exhib_con
		,exhib_current
		,exhib_page
		) VALUES (
		sf_new_exhib_code()
		,#{musCode}
		,#{exhibCate}
		,#{exhibCateName}
		,#{exhibName}
		,#{exhibStart}
		,#{exhibEnd}
		,#{exhibCon}
		,#{exhibCurrent}
		,#{exhibPage}
		);
	</insert>

	<!-- 전시회 명 중복 체크 -->
   <select id="isNameCheck" parameterType="String" resultType="boolean">
      SELECT
         IF(COUNT(1) = 1, 0, 1)
      FROM 
         tb_exhib AS e
      WHERE 
         e.exhib_name = #{exhibName};
   </select>

	<!-- 코드에 따른 전시회 조회 SQL -->
	<select id="getExhibByCode" parameterType="String" resultMap="exhibResultMap">
		SELECT
		 s.exhib_code
		,s.mus_code
		,s.exhib_cate
		,s.exhib_cate_name
		,s.exhib_name
		,s.exhib_start
		,s.exhib_end
		,s.exhib_con
		,s.exhib_current
		,s.exhib_page
		FROM
			tb_exhib AS s
		WHERE
			exhib_code = #{exhibCode};
	
	</select>
	
	<!-- 전시회 목록 조회 SQL -->
	<select id="getExhibList" resultMap="exhibResultMap">
		SELECT
		 s.exhib_code
		,s.mus_code
		,s.exhib_cate
		,s.exhib_cate_name
		,s.exhib_name
		,s.exhib_start
		,s.exhib_end
		,s.exhib_con
		,s.exhib_current
		,s.exhib_page
		FROM
		tb_exhib AS s
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchKey != null and searchKey != '' and searchValue != ''">
		 		AND ${searchKey} LIKE CONCAT('%', #{searchValue}, '%')
		 	</if>
		</trim>
		ORDER BY s.exhib_code;
	</select>
	
	<!-- 전시회 수정 SQL -->
	<update id="modifyExhib" parameterType="Exhib">
		UPDATE tb_exhib
		<trim prefix="SET" suffixOverrides=",">
			<if test="musCode != null and musCode != ''">
				mus_code = #{musCode},
			</if>		
			<if test="exhibCate != null and exhibCate != ''">
				exhib_cate = #{exhibCate},
			</if>		
			<if test="exhibCateName != null and exhibCateName != ''">
				exhib_cate_name = #{exhibCateName},
			</if>		
			<if test="exhibName != null and exhibName != ''">
				exhib_name = #{exhibName},
			</if>		
			<if test="exhibStart != null and exhibStart != ''">
				exhib_start = #{exhibStart},
			</if>		
			<if test="exhibEnd != null and exhibEnd != ''">
				exhib_end = #{exhibEnd},
			</if>		
			<if test="exhibCon != null and exhibCon != ''">
				exhib_con = #{exhibCon},
			</if>		
			<if test="exhibCurrent != null and exhibCurrent != ''">
				exhib_current = #{exhibCurrent},
			</if>		
			<if test="exhibPage != null and exhibPage != ''">
				exhib_page = #{exhibPage},
			</if>		
		</trim>
		WHERE
			exhib_code = #{exhibCode};
	</update>
	
	<!-- 전시회 정보 삭제 SQL -->
	<delete id="removeExhib" parameterType="String">
		DELETE
		FROM
			tb_exhib
		WHERE
			exhib_code = #{exhibCode};
	</delete>
</mapper>