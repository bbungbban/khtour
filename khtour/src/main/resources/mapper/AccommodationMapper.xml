<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart42.khtour.mapper.AccommodationMapper">

	<resultMap type="Accommodation" 		id="accommodationResultMap">
		<id column="ldg_code" 				property="ldgCode" />
		<result column="ldg_name" 			property="ldgName" />
		<result column="ldg_type" 			property="ldgType" />
		<result column="business_number" 	property="businessNumber" />
		<result column="ldg_addr" 			property="ldgAddr" />
		<result column="ldg_detail_addr" 	property="ldgDetailAddr" />
		<result column="ldg_explain1" 		property="ldgExplain1" />
		<result column="ldg_explain2" 		property="ldgExplain2" />
		<result column="ldg_explain3" 		property="ldgExplain3" />
		<result column="ldg_explain4" 		property="ldgExplain4" />
		<result column="ldg_tel" 			property="ldgTel" />
		<result column="ldg_phone"			property="ldgPhone" />
		<result column="ldg_email" 			property="ldgEmail" />
		<result column="file_path" 			property="ldgImagePath"/>
	</resultMap>

	<!-- 코드에 따른 숙박업소 조회 SQL -->
	<select id="getLdgByCode" parameterType="String"
		resultMap="accommodationResultMap">
		SELECT
		l.ldg_code
		,l.ldg_name
		,l.ldg_type
		,l.business_number
		,l.ldg_addr
		,l.ldg_detail_addr
		,l.ldg_explain1
		,l.ldg_explain2
		,l.ldg_explain3
		,l.ldg_explain4
		,l.ldg_tel
		,l.ldg_phone
		,l.ldg_email
		FROM
		tb_ldg_information AS l
		WHERE
		ldg_code = #{ldgCode};

	</select>

	<!-- 숙박업소 정보 삭제 SQL -->
	<delete id="removeAccommodation" parameterType="String">
		DELETE
		FROM
		tb_ldg_information
		WHERE
		ldg_code = #{ldgCode};
	</delete>

	<!-- 숙박업소 등록 SQL -->
	<insert id="addAccommodation" parameterType="Accommodation">
	<selectKey resultType="string" keyProperty="ldgCode" order="BEFORE">
			SELECT sf_new_ldg_code() as ldgCode
	</selectKey>
		INSERT INTO
			tb_ldg_information
			( ldg_code
			,ldg_name
			,ldg_type
			,business_number
			,ldg_addr
			,ldg_detail_addr
			,ldg_explain1
			,ldg_explain2
			,ldg_explain3
			,ldg_explain4
			,ldg_tel
			,ldg_phone
			,ldg_email
			,ldg_homepage
		)VALUES (
			 #{ldgCode}
			,#{ldgName}
			,#{ldgType}
			,#{businessNumber}
			,#{ldgAddr}
			,#{ldgDetailAddr}
			,#{ldgExplain1}
			,#{ldgExplain2}
			,#{ldgExplain3}
			,#{ldgExplain4}
			,#{ldgTel}
			,#{ldgPhone}
			,#{ldgEmail}
			,#{ldgHomepage}
			);
	</insert>

	<!-- 숙박업소 목록 조회 SQL -->
	<select id="getAccommodationList"
		resultMap="accommodationResultMap">
		SELECT
			l.ldg_code
			,l.ldg_name
			,l.ldg_type
			,l.business_number
			,l.ldg_addr
			,l.ldg_detail_addr
			,l.ldg_explain1
			,l.ldg_explain2
			,l.ldg_explain3
			,l.ldg_explain4
			,l.ldg_tel
			,l.ldg_phone
			,l.ldg_email
			,f.file_path
		FROM
			tb_ldg_information AS l
		LEFT JOIN 
		   tb_file_control AS fc
		   ON 
		   l.ldg_code = fc.reference_code
		   LEFT JOIN 
		   tb_file AS f
		   ON 
		   fc.file_idx = f.file_idx
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchKey != null and searchKey != '' and searchValue != ''">
				${searchKey} LIKE CONCAT('%', #{searchValue}, '%')
		 	</if>
		</trim>
		ORDER BY l.ldg_code;
	</select>

	<!-- 숙박업소 정보 수정 SQL -->
	<update id="modifyAccommodation" parameterType="Accommodation">
		UPDATE tb_ldg_information
		<trim prefix="SET" suffixOverrides=",">
			<if test="ldgName != null and ldgName != ''">
				ldg_name = #{ldgName},
			</if>
			<if test="ldgType != null and ldgType != ''">
				ldg_type = #{ldgType},
			</if>
			<if test="businessNumber != null and businessNumber != ''">
				business_number = #{businessNumber},
			</if>
			<if test="ldgAddr != null and ldgAddr != ''">
				ldg_addr = #{ldgAddr},
			</if>
			<if test="ldgDetailAddr != null and ldgDetailAddr != ''">
				ldg_detail_addr = #{ldgDetailAddr},
			</if>
			<if test="ldgExplain1 != null and ldgExplain1 != ''">
				ldg_explain1 = #{ldgExplain1},
			</if>
			<if test="ldgExplain2 != null and ldgExplain2 != ''">
				ldg_explain2 = #{ldgExplain2},
			</if>
			<if test="ldgExplain3 != null and ldgExplain3 != ''">
				ldg_explain3 = #{ldgExplain3},
			</if>
			<if test="ldgExplain4 != null and ldgExplain4 != ''">
				ldg_explain4 = #{ldgExplain4},
			</if>
			<if test="ldgTel != null and ldgTel != ''">
				ldg_tel = #{ldgTel},
			</if>
			<if test="ldgPhone != null and ldgPhone != ''">
				ldg_phone = #{ldgPhone},
			</if>
			<if test="ldgEmail != null and ldgEmail != ''">
				ldg_email = #{ldgEmail},
			</if>
			<if test="ldgHomepage != null and ldgHomepage != ''">
				ldg_homepage = #{ldgHomepage},
			</if>
		</trim>
		WHERE
		ldg_code = #{ldgCode};
	</update>
</mapper>